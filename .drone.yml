pipeline:
  test:
    image: localhost:5000/aws-k8s-docker
    pull: true
    commands:
      - pip install -r requirements.txt
      - /opt/login.sh
      - kubectl-conf int --kops
      - python -m nose
      - behave -D mode=aws features
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  publish:
    image: plugins/docker
    repo: localhost:5000/drone/k8s-deployer
    tags: latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    when:
      event: push
      branch: develop
